<!DOCTYPE html>
<html>
  <head>
    <style>
      .button-container {
        width: 390px;
        background: beige;
        overflow-y: auto;
      }
      .button-container > input {
        float: left;
        width: 100px;
        height: 100px;
        background: white;
        margin: 15px;
        font-size: 50px;
      }
    </style>
    <script>
      let allLetters = {{letters}};
      let allWords = {{all_words}};
      let primaryLetter = "{{primary}}";
      let minLength = {{minLength}};
      let buttonToLetter = {};

      let allWordsSet = new Set();
      for (let i = 0; i < allWords.length; i++) {
        allWordsSet.add(allWords[i]);
      }

      let guessedAlready = new Set();
      let points = 0;

      function shuffleArray(array) {
        for (var i = array.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var temp = array[i];
            array[i] = array[j];
            array[j] = temp;
        }
      }

      function setLetters() {
        let letterIdx = 0;
        for (let j = 0; j < 3; j++) { // columns
          for (let i = 1; i < 3; i++) { // rows
            if (allLetters[letterIdx] === primaryLetter) {
              letterIdx++;
            }
            buttonToLetter[("" + i) + j] = allLetters[letterIdx];
            document.getElementById(("" + i) + j).value = allLetters[letterIdx];
            letterIdx++;
          }
        }
      }

      function setPrimary() {
        document.getElementById("01").value = primaryLetter;
        buttonToLetter["01"] = primaryLetter;
      }

      function setPoints(points) {
        document.getElementById("points").innerHTML = "Points: " + points;
      }

      function setFeedback(fdb) {
        document.getElementById("feedback").innerHTML = fdb;
      }

      function handleLetterButton(i, j) {
        if (i > 0 || (i == 0 && j == 1)) {
          let prevText = document.getElementById("guess").value;
          document.getElementById("guess").value = prevText + buttonToLetter[(i + "") + j];
        }
      }

      function shuffle() {
        shuffleArray(allLetters);
        setLetters();
      }

      function makeGuess() {
        let guess = document.getElementById("guess").value.toLowerCase();
        if (guess.length < minLength) {
          setFeedback("Word length must be at least " + minLength);
        } else if (!guessedAlready.has(guess)) {
          if (allWordsSet.has(guess)) {
            guessedAlready.add(guess);
            points += guess.length;
            setPoints(points);
            setFeedback("Nice work!");
          } else if (!guess.includes(primaryLetter)) {
            setFeedback("Remember to include '" + primaryLetter + "'");
          } else {
            setFeedback("'" + guess + "' is not a recognized word");
          }
        } else {
          setFeedback("You've already guessed '" + guess + "'");
        }
        document.getElementById("guess").value = "";
      }
    </script>
    <title>Spelling</title>
  </head>
  <body onload="setLetters(); setPrimary()">
    <h2 id="points">Points: 0</h2>
    <form>
      <div class="button-container">
        <input type="button" id="00" onclick="handleLetterButton(0, 0)">
        <input type="button" id="01" onclick="handleLetterButton(0, 1)" style="color:darksalmon;">
        <input type="button" id="02" onclick="handleLetterButton(0, 2)">
        <input type="button" id="10" onclick="handleLetterButton(1, 0)">
        <input type="button" id="11" onclick="handleLetterButton(1, 1)">
        <input type="button" id="12" onclick="handleLetterButton(1, 2)">
        <input type="button" id="20" onclick="handleLetterButton(2, 0)">
        <input type="button" id="21" onclick="handleLetterButton(2, 1)">
        <input type="button" id="22" onclick="handleLetterButton(2, 2)">
      </div>
      <input type="button" id="shuffleButton" value="Shuffle" onclick="shuffle()">
      <input type="text" id="guess">
      <input type="button" id="submit" value="Try Word" onclick="makeGuess()">
    </form>
    <h2 id="feedback"></h2>
  </body>
</html>